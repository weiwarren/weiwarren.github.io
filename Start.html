<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title> PWC IPower Browser Remediation - Kloud Solutions </title>

		<meta name="description" content="">
		<meta name="author" content="Hector Maldonado, Warren Wei">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
       
       

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			
			<div class="slides">
				


                <section  >
                    <img src="custom/790px-Pwc_logo.svg_-300x227.png" style="border:0; max-width:300px; max-height:250px;" />
                    <h1>PwC iPower </h1>
                    <h3>Browser Remediation</h3>
                    <p>
                        <small>Created by Kloud Solutions</small>
                    </p>
                </section>


             

                <!-- SCRIPT INJECTION -->

                <section data-background>

                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>Global Script Configuration</h2>

                        <p>
                            Investigation of how scripts are configured in the project to evaluate the way remediations can be injected in with a minimal refactoring.
                        </p>
                    </section>

                    <section>
                        
                        <h3>Analysis</h3>
                        <ul>
                            <li>Static resources such as JavaScripts and StyleSheets are configured on every aspx page </li>
                            <li>Global resource references (iShared) are repeated across pages</li>

                        </ul>

                        <pre><code>                     
	&lt;LINK HREF=&quot;../iShared/styles/pwcGrid.css&quot; ... 
	&lt;LINK HREF=&quot;../iShared/styles/pwcLookUp.css&quot; ...
	&lt;LINK HREF=&quot;../iShared/styles/pwcGlobal.css&quot;  ...
	&lt;SCRIPT SRC=&quot;../iShared/scripts/pwcClientJobProjSelection.js&quot; ...
					    </code></pre>

                    </section>

                    <section>
                        <h3>Remediation</h3>
                        <p>
                            An Asp.Net module could be developed to inject the new static web resouces into the output stream.
                        </p>

                    </section>

                </section>
				
                
			
                
                <!-- EXCEPTION HANDLING -->

                <section data-background>

                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>Global Exception Handling</h2>

                        <p>
                            Regular expressions queries against the code base have helped us to identify a great number of commonly used legacy techniques that will be replaced.
                        </p>

                        <p>
                            However,we will still require monitoring tools to inform us about the edge cases that
                            we have not been able to identify yet as well as any possible errors that could occur on the browser.
                        </p>
                    </section>

                    <section>
                        <h3>Analysis</h3>

                        <p>
                            Currently IPower does not seem to benefit from a global way of monitoring client side exceptions.
                        </p>

<pre><code data-trim>
    if (objXMLRS.Error == true) {
        //Take action based on the error code returned
        switch (objXMLRS.ReturnCode) {
            case gkCODE_ERROR_CONNECTION:
                return false;
            default:
                alert(objXMLRS.ErrorMsg);
                return false;
                break;
        }
    }
</code></pre>




                    </section>

                    <section>
                        <h3>Remediation</h3>
                        <p>
                            Cloud Service Provider for this matter are the best possible choice for the following reasons:
                        </p>



                        <ul>
                            <li>Can provide extense analytics</li>
                            <li>Used by leaders in the industry</li>
                            <li>No need to worry about heavy loads</li>
                            <li>No need for inhouse administration</li>
                            <li>Provide logging features for multiple technology stacks</li>
                            <li>Consistent error handling accross projects and stacks</li>
                        </ul>
                    </section>

                    <section>

                        <h4> Option: <strong> Sentry</strong></h4>

                        <ul>
                            <li>Full Stack  Open Source error handling framework</li>
                            <li>Go to <a href="https://www.getsentry.com/welcome/" target="_blank">Website</a></li>
                            <li>Paid Cloud Hosted service owned by DISCUS (Up to 200 events per minute $199/month)</li>
                        </ul>

                        <br />
                        <br />
                        <blockquote style="padding:20px">
                            Used by Instagram, Uber, NYTimes, Spotify, etc.
                        </blockquote>
                    </section>

                    <section>

                        <h4> Option: <strong>AirBreak</strong></h4>

                        <ul>
                            <li>Full Stack error handling framework</li>
                            <li>Go to <a href="https://airbrake.io/" target="_blank">Website</a></li>
                            <li> Paid Cloud Hosted service owned by Rackspace (from $39 for 5 projects users to $199/month for 40 projects)</li>
                        </ul>


                        <br />
                        <br />
                        <blockquote style="padding:20px">
                            Used by Oracle, Groupon, Zendesk, TaskRabit, etc.
                        </blockquote>

                    </section>

                    <section>

                        <h4> Option: <strong>Errorception</strong></h4>

                        <ul>
                            <li>JavaScript specialized error handling framework</li>
                            <li>Go to <a href=" https://errorception.com" target="_blank">Website</a></li>
                            <li>  Paid Cloud Hosted service owned by Rakesh Pai (Up to 20,000 errors/day for $59/month)</li>
                        </ul>


                        <br />
                        <br />
                        <blockquote style="padding:20px">
                            Used by KhanAccademy, SoundCloud, The Guardian, etc.
                        </blockquote>

                    </section>

                </section>


               

                <!-- ARRAY INDEXERS -->

                <section data-background>


                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>Array Indexers</h2>

                        <p>
                            Array element are accessed by using parenthesis instead of square brackets.
                        </p>

<pre><code data-trim>
function fnGridColumnHide(tblGrid, intColIndex, strDisplayStyle) {
    //apply the given style to the col group
    try {
        //set COL style (required to hide column on grid)
        tblGrid
          .children(0)
          .children(intColIndex)
          .style.display = strDisplayStyle;
        //set TD style - this has undesirable side effects
    }
    catch (e) {
    }
    return;
}
    </code></pre>
                    </section>

                    <section>
                        <h3>Analysis</h3>

                        <ul>
                            <li> Not supported in chrome and probably will not be supported after IE 11.</li>
                            <li>This IE specific operator is widely used across all JavasSript files.</li>
                            <li>
                                Usage examples are the following: 
                                cell(x), rows(x), item(x), attributes(x), children(x), Fields(x), forms(x), childNodes(x), options(x)
                            </li>
                        </ul>

                    </section>

                    <section>
                        <h3>Remediation</h3>
                        <p>
                            We failed to extend the HTMLSelectElement type's prototype with a function of the stlye "options(idx)" because the browser prevents it, possibly 
                            prevent property vs method collision.
                            
                        </p>
                        <p>
                            This case will then have to be resolved by replacing instances of the pattern in  the entire codebase using regular expressions.
                        </p>
                    </section>

                    <section>
                        <h3>Additional resources</h3>

                        <p>Regular Expression search for this pattern:</p>
<pre><code data-trim>
[^\w][\w]+\.(?!setdate|substring|scrollto|setposition|charat
    |insertcell|setminutes|setseconds|sethours
    |setmilliseconds|toFixed|fromCharCode|toFixed
    |substr)[\w]+\(\d+\)[^\w] 
</code></pre>
                        
                        <p>Filter files: pwc*.js</p>


                    </section>


                </section>


              

                <!-- .jse FILES  -->

                <section data-background>

                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>.jse Files</h2>

                        <p>
                            There are a number of JScript.Encode files which require remediation.
                        </p>

<pre><code>
    &lt;script src=&quot;../iShared/scripts/pwcEncrypt.jse&quot; ...
    &lt;script src=&quot;../iShared/scripts/pwcFeeNote.jse&quot; ...
    &lt;script src=&quot;../iShared/scripts/pwcFeeNoteConstants.jse&quot; ...
    </code></pre>
                    </section>

                    <section>
                        <h3>Analysis</h3>

                        <ul>
                            <li> JScript Encoded File developed by Microsoft</li>
                            <li>Script written in JScript, a programming language used for Windows and Microsoft Internet Explorer scripting; contains source code in a format similar to JavaScript, but the JScript specification is maintained by Microsoft..</li>
                            <li>JScript is often used for including interactive content in Web pages and Web applications.</li>
                        </ul>

                    </section>

                    <section>
                        <h3>Remediation</h3>

                        <p>
                            Initial discussions revealed that these files do not contain useful logic and therefore can be removed.
                        </p>

                    </section>

                </section>


               

                <!-- IE Events -->

                <section data-background>

                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>IE specific events</h2>

                        <p>
                            There are a number of Internet Explorer specific browser events that have to be ported to their cross browser alternative.
                        </p>
                        <p>
                            The list of the events can be  
                            <a href="http://en.wikipedia.org/wiki/DOM_events#Microsoft-specific_events" target="_blank">viewed here</a>.

                        </p>
                    </section>

                    <section>
                        <h3>Analysis: <strong>Safe Events (A)</strong></h3>

                        <ul>
                            <li><strong>cut|copy|paste</strong>: <a href="http://www.quirksmode.org/dom/events/cutcopypaste.html" target="_blank">is cross browser compatible</a> </li>
                            <li><strong>beforecut|beforecopy|beforepaste</strong>: don’t seem to be present</li>
                            <li><strong>contextmenu</strong>: <a href="http://www.quirksmode.org/dom/events/contextmenu.html" target="_blank">is cross browser compatible</a></li>
                            <li><strong>drag|dragstart|dragenter|dragover|dragleave|dragend|drop</strong>: don't seem to be present.</li>
                            <li><strong>help</strong>: captured by flash plugin script but not handled
                            <li><strong>beforeunload</strong>: <a href="http://www.w3schools.com/jsref/event_onbeforeunload.asp" target="_blank">is cross browser compatible</a></li>
                            <li><strong>stop</strong>: does not seem to be present</li>
               
                        </ul>

                    </section>

                    <section>
                        <h3>Analysis: <strong>Safe Events (B)</strong></h3>

                        <ul>
                            <li><strong>beforeeditfocus|start|finish|bounce</strong>: don’t seem to be present</li>
                            <li><strong>filterchange|losecapture</strong>: don’t seem to be used</li>
                            <li><strong>cellchange|dataavailable|datasetchanged</strong>: don’t seem to be used</li>
                            <li><strong>errorupdate|rowenter|rowexit|rowsdelete|rowinserted</strong>: don’t seem to be used</li>
                        </ul>

                    </section>

                    <section>
                        <h3>Analysis: <strong>Unsafe </strong></h3>

                        <ul>
                            <li><strong>afterupdate|beforeupdate|datasetcomplete</strong></li>
                            <li><strong>selectstart</strong></li>
                            <li><strong>beforeprint|afterprint</strong></li>
                            <li><strong>propertychange</strong></li>
                            <li><strong>readystatechange</strong></li>
                        </ul>
                       
                    </section>

                    <section>
                        <h3>Remediation</h3>

                        <p>
                            Each event type will have to be handled independently and registered using their standard counterparts.
                        </p>

                    </section>

                    <section>
                        <h3>Additional resources (A)</h3>

                        <p>Search for <strong> afterupdate|beforeupdate|datasetcomplete</strong></p>
<pre><code data-trim>
         [^\w](on|\.)(afterupdate|beforeupdate|datasetcomplete)[^\w] 
</code></pre>

                        <p>File names to match expression: </p>
<pre><code data-trim>
(?!Autofac|Telerik|ISNet|log4net|Microsoft|Newtonsoft
    |RadAjax|StackExchange|System|RadGrid|RadMenu
    |SLCommonControls|iClient).*
</code></pre>

                        <p>Requires custom code to mimic the behaviour </p>   

                    </section>

                    <section>
                        <h3>Additional resources (B)</h3>

                        <p>Search for <strong>selectstart</strong></p>
<pre><code data-trim>
         [^\w](on|\.)(selectstart)[^\w] 
</code></pre>

                        <p>File names to match expression: </p>
<pre><code data-trim>
(?!Autofac|Telerik|ISNet|log4net|Microsoft|Newtonsoft
    |RadAjax|StackExchange|System|RadGrid|RadMenu
    |SLCommonControls|iClient).*
</code></pre>

                        <ul>
                            <li>
                                There is a chance it could work according to the following document: <a href=" http://help.dottoro.com/ljnactnw.php" target="_blank"> click to view</a>
                            </li>
                            <li>
                                Otherwise we could introduce a cross browser workaround such
                                as
                                the following:
                                <a href="http://stackoverflow.com/questions/235411/is-there-an-internet-explorer-approved-substitute-for-selectionstart-and-selecti">
                                    click to view
                                </a>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h3>Additional resources (C)</h3>

                        <p>Search for <strong>beforeprint|afterprint</strong></p>
<pre><code data-trim>
        [^\w](on|\.)(beforeprint|afterprint)[^\w] 
</code></pre>

                        <p>File names to match expression: </p>
<pre><code data-trim>
(?!Autofac|Telerik|ISNet|log4net|Microsoft|Newtonsoft
    |RadAjax|StackExchange|System|RadGrid|RadMenu
    |SLCommonControls|iClient).*
</code></pre>

                        <ul>
                            <li>Neither is supported by Chrome: 
                            <a href="http://www.w3schools.com/tags/ev_onbeforeprint.asp" target="_blank">beforeprint</a> , 
                            <a href="http://www.w3schools.com/tags/ev_onafterprint.asp" target="_blank">afterprint</a> 
                            </li>
                            <li>User workflow must be rethought since there is no cross browser remediation possible.</li>
                        </ul>
                       
                    </section>

                    <section>
                        <h3>Additional resources (D)</h3>

                        <p>Search for <strong>propertychange</strong></p>
<pre><code data-trim>
                 [^\w](on|\.)(propertychange)[^\w]  
</code></pre>

                        <p>File names to match expression: </p>
<pre><code data-trim>
(?!Autofac|Telerik|ISNet|log4net|Microsoft|Newtonsoft
    |RadAjax|StackExchange|System|RadGrid|RadMenu
    |SLCommonControls|iClient).*
</code></pre>

                        <ul>
                            <li>
                                Neither is supported by Chrome:
                                <a href=" http://help.dottoro.com/ljufknus.php" target="_blank">propertychange</a> 
                            </li>
                            <li>This catch all case would have to be independently evaluated whenever used and replaced with cross browser specific events.</li>
                            <li>General resources: <a href="http://benalpert.com/2013/06/18/a-near-perfect-oninput-shim-for-ie-8-and-9.html" target="_blank">click to view</a></li>
                        </ul>

                    </section>

                    <section>
                        <h3>Additional resources (E)</h3>

                        <p>Search for <strong>readystatechange</strong></p>
<pre><code data-trim>
        [^\w](on|\.)(readystatechange|)[^\w]
</code></pre>

                        <p>File names to match expression: </p>
<pre><code data-trim>
(?!Autofac|Telerik|ISNet|log4net|Microsoft|Newtonsoft
    |RadAjax|StackExchange|System|RadGrid|RadMenu
    |SLCommonControls|iClient).*
</code></pre>

                        <ul>
                            <li>
                                Not supported by Chrome: 
                                <a href=" http://help.dottoro.com/ljerfwdm.php" target="_blank">readystatechange</a>
                            </li>
                            <li>Maybe can be overcome with DOM change observer: <a href="http://stackoverflow.com/questions/3219758/detect-changes-in-the-dom" target="_blank">click to view</a></li>
                        </ul>

                    </section>
                </section>




                <!-- PROPERTY CHANGE -->

                <section data-background>

                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>onpropertychange event</h2>

                        <p>
                            Investigation of how scripts are configured in the project to evaluate the way remediations can be injected in with a minimal refactoring.
                        </p>
                    </section>

               

                </section>


                

                <!-- WINDOW.EVENT -->

                <section data-background>

                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>window.event</h2>

                        <p>
                            Internet Explorer provides a global object window.event, which references the last event. And before IE9 there are no arguments in the handler.
                        </p>

<pre><code data-trim>                     
element.onclick = function() {
    // window.event - is the event object
}	
</code></pre>
                        



                    </section>

                    <section>

                        <h3>Analysis (A)</h3>
                        <ul>
                            <li>window.event is supported by IE, Chrome, Safari and Opera: <a href="http://blog.strictly-software.com/2009/10/windowevent-support-cross-browser.html" target="_blank">view info (confirmed by tests)</a> </li>
                            <li>The following is a list of all event properties and their support cross browser: <a href="http://help.dottoro.com/ljlsaxen.php" target="_blank">view list</a> </li>
                            
                        </ul>

                        <pre><code data-trim>                     
window.event.keyCode
window.event.returnValue
window.event.clientX
window.event.clientY
window.event.srcElement
window.event.cancelBubble
window.event.offsetX
window.event.offsetY
window.event.button
window.event.propertyName
window.event.toElement
					    </code></pre>

                    </section>

                    <section>

                        <h3>Analysis (B)</h3>
                        <p>Safe uses are the following: </p>

                        <pre><code data-trim>                     
window.event.keyCode
window.event.returnValue
window.event.clientX
window.event.clientY
window.event.srcElement
window.event.cancelBubble
window.event.offsetX
window.event.offsetY
window.event.button
window.event.toElement
					    </code></pre>

                        <br />
                        <p>Unsupported uses are the following (only in <strong>bhvTableRowOver.htc</strong> and  <strong>bhvRollOver.htc</strong>)</p>
                        <pre><code data-trim>                     
window.event.propertyName
					    </code></pre>

                    </section>


                    <section>
                        <h3>Remediation</h3>
                        <p>
                            <strong>bhvTableRowOver.htc</strong> and  <strong>bhvRollOver.htc</strong> are behaviours originally authored by Microsoft
                            and used to apply custom functionality to tables: striping, hovering and other useful features to regular and data-bound table rows.
                        </p>
                        <p>
                            These scripts should be entirely removed and replaced since they are quite complex and are not widely used (only in the <strong>PwCCube</strong> project).
                        </p>
                    </section>

                </section>



               
                <!-- .jse FILES  -->

                <section data-background>

                    <section>
                        <h2 class="sectionIdx"></h2>
                        <h2>.HTC Behaviors</h2>

                        <p>
                            Introduced in Internet Explorer 5, HTCs provide a simple mechanism to implement DHTML behaviors in script and are obsolete in IE10 and not supported by Chrome. 
                        </p>

                    </section>

                    <section>
                        <h3>Analysis</h3>

                        <ul>
                            <li>There are 30 HTC files in total</li>
                            <li>Two files are authored by Microsoft and are used to extend functionality in Grids (<strong>PwCCube</strong>)</li>
                            <li>Attached through StyleSheets, AdhocStyles and through code in one case </li>
                        </ul>


<pre><code data-trim>                     
         &lt;style&gt;
    .clsGridRow {
        BEHAVIOR: url(../iShared/scripts/pwcIntersoftGrid.htc);
        CURSOR: hand;
    }
&lt;/style&gt;

Response.Write(&quot;&lt;TABLE STYLE=&quot; + Chr(34) 
    + &quot;behavior:url(&#39;scripts/bhvTablerowOver.htc&#39;)&quot; 
    + Chr(34) + &quot; SELECTABLE=0 STRIPED=1 BORDER=0 WIDTH=100% &gt;&quot; 
    + vbCrLf) 
</code></pre>

                    </section>

                    <section>
                        <h3>Remediation</h3>

                       <p>
                           .htc files must be independently evaluated and rewritten making sure their methods do not pollute the global context. 
                       </p>
                        <p>
                            The two .htc  authored by Microsoftused in the PwCCube project must be rewritten or replaced by a library that extends functionality on tables.
                        </p>

                    </section>

                </section>





			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
        <script src="js/jquery-1.11.2.js"></script>
		<script src="js/reveal.js"></script>


        <style>
            h1, h2, h3, h4, h5, h6 {
                text-transform: none !important;
                font-weight: normal !important;
                letter-spacing: -1px !important;
            }

            h2 {
                font-size: 1.8em !important;
            }

            h3 {
                font-size: 1.5em !important;
            }

            h4 {
                font-size: 1.3em !important;
            }

            h2.sectionIdx {
                font-size: 3em !important;
                padding: 0 !important;
                margin: 0 !important;
                line-height: 0.8em;
                font-weight: bold;
                color: #444;
            }
        </style>


        <script>
            (function () {
                var colors = ['CDFFC5', 'f5ebd9', 'FFD7A9', 'ddeee6', 'FFABC4', 'd6ded0', 'BEACFF', 'f5d9f4', 'A0E1E8', 'e9ceeb']
                var colorStack = [];
                
                function getNextColor() {
                    if(colorStack.length == 0)
                        colorStack = colors.slice(0).reverse();
                    return '#' + colorStack.pop();
                }

                function prepare() {
                    $('section[data-background]').each(function (idx) {
                        var $el = $(this);
                        $el.find('.sectionIdx').text(idx + 1);
                        var color = getNextColor();
                        console.log($el)
                        $el.attr('data-background', color);
                    })
                }

                prepare();

            })();
        </script>
		<script>


            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,
                slideNumber: true,
                transition: 'slide', // none/fade/slide/convex/concave/zoom

                // Optional reveal.js plugins
                dependencies: [
					{ src: 'lib/js/classList.js', condition: function () { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
					{ src: 'plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function () { return !!document.querySelector('pre code'); }, callback: function () { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
                ]
            });

            Reveal.configure({ backgroundTransition: 'zoom' })
		</script>

	</body>
</html>
